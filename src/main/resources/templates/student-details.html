<!DOCTYPE html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="${title} ?: 'Ученик'">Ученик</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/app.css}">

</head>
<body>
<nav th:replace="fragments/navbar :: main-navbar"></nav>


<div class="container mt-4">
    <h1 th:text="${student.fullName}">ФИО ученика</h1>

    <dl class="row">
        <dt class="col-sm-3">Дата рождения</dt>
        <dd class="col-sm-9" th:text="${student.dateOfBirth}">2005-01-01</dd>

        <dt class="col-sm-3">Год поступления</dt>
        <dd class="col-sm-9" th:text="${student.admissionYear}">2024</dd>

        <dt class="col-sm-3">Группа</dt>
        <dd class="col-sm-9">
            <span th:if="${student.group != null}">
                <a th:href="@{'/groups/' + ${student.group.id}}"
                   th:text="${student.group.code + ' — ' + student.group.name}">
                    JIV-101 — Живопись 1 курс
                </a>
            </span>
            <span th:if="${student.group == null}">
                Не назначена
            </span>
        </dd>

        <dt class="col-sm-3">Email</dt>
        <dd class="col-sm-9" th:text="${student.email}">student@example.com</dd>

        <dt class="col-sm-3">Телефон</dt>
        <dd class="col-sm-9" th:text="${student.phone}">+7...</dd>
    </dl>

    <div class="mt-3">
        <h5>Заметки</h5>
        <p th:text="${student.notes}">
            Здесь можно указать особенности обучения, участие в выставках и т.п.
        </p>
    </div>

    <div class="mt-3">
        <a class="btn btn-secondary" th:href="@{/students}">Назад к списку</a>
        <a class="btn btn-primary"
           th:href="@{'/students/' + ${student.id} + '/edit'}"
           sec:authorize="hasRole('ADMIN')">
            Редактировать
        </a>
    </div>
</div>
<div class="mt-4" th:if="${performance != null}">
    <h3>Успеваемость</h3>

    <!-- Общий средний балл -->
    <div class="mb-3">
        <strong>Общий средний балл:</strong>
        <span th:if="${performance.overallAverage != null}"
              th:text="${#numbers.formatDecimal(performance.overallAverage, 1, 2)}">4.25</span>
        <span th:if="${performance.overallAverage == null}" class="text-muted">
            пока нет оценок
        </span>
    </div>

    <!-- Средние баллы по предметам -->
    <h5>Средний балл по предметам</h5>
    <div th:if="${#lists.isEmpty(performance.subjectStats)}">
        <p class="text-muted">Для этого ученика ещё нет оценок.</p>
    </div>

    <table class="table table-sm table-bordered align-middle"
           th:if="${!#lists.isEmpty(performance.subjectStats)}">
        <thead class="table-light">
        <tr>
            <th>Предмет</th>
            <th>Количество оценок</th>
            <th>Средний балл</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="s : ${performance.subjectStats}">
            <td th:text="${s.subject.code + ' — ' + s.subject.name}">PNT-101 — Живопись</td>
            <td th:text="${s.count}">10</td>
            <td th:text="${#numbers.formatDecimal(s.average, 1, 2)}">4.20</td>
        </tr>
        </tbody>
    </table>

    <!-- Хронологический список всех оценок -->
    <h5 class="mt-4">Все оценки по датам</h5>

    <div th:if="${#lists.isEmpty(performance.grades)}">
        <p class="text-muted">Оценок пока нет.</p>
    </div>

    <table class="table table-sm table-striped"
           th:if="${!#lists.isEmpty(performance.grades)}">
        <thead class="table-light">
        <tr>
            <th>Дата</th>
            <th>Время</th>
            <th>Предмет</th>
            <th>Группа</th>
            <th>Оценка</th>
            <th>Комментарий</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="g : ${performance.grades}">
            <td th:text="${#temporals.format(g.lesson.date, 'dd.MM.yyyy')}">01.09.2025</td>
            <td th:text="${#temporals.format(g.lesson.startTime, 'HH:mm')}">09:00</td>
            <td th:text="${g.lesson.subject.code + ' — ' + g.lesson.subject.name}">
                PNT-101 — Живопись
            </td>
            <td th:text="${g.lesson.group.code}">JIV-101</td>
            <td><strong th:text="${g.value}">5</strong></td>
            <td th:text="${g.comment}">Молодец!</td>
        </tr>
        </tbody>
    </table>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
</body>
</html>
